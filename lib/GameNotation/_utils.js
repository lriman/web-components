"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getInlineMoveBackgroundColor=exports.getTreeBackgroundColor=exports.getTreeBorderColor=exports.getScrollbarThumbColor=exports.getScrollbarTrackColor=exports.getMoveBackgroundColor=exports.getMoveColor=exports.getCellBackgroundColor=exports.getCellColor=exports.getColumnLabelColor=exports.notationScroll=exports.getIsVisible=exports.getRelativePosition=exports.getNewItems=exports.getTreeKey=exports.getItemType=exports.getFullNotation=exports.getAlarmClockColor=exports.getTimeLimit=exports.getDifferentInTime=exports.formatTime=void 0;var _moment=_interopRequireDefault(require("moment"));var _constants=require("./_constants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var formatTime=function formatTime(time){return _moment["default"].duration(time).format().replace(/ milliseconds/,'ms').replace(/ days| day/,'d').replace(/ hours| hour/,'h');};exports.formatTime=formatTime;var getDifferentInTime=function getDifferentInTime(timeLeft,lastMove,isCountdown,finished){if(finished)return 0;if(!isCountdown)return timeLeft;var currentTime=Date.now();var result=timeLeft-((0,_moment["default"])(currentTime)-(0,_moment["default"])(lastMove));return result>0?result:0;};exports.getDifferentInTime=getDifferentInTime;var getTimeLimit=function getTimeLimit(data,color){var lastMove=data&&data.lastMove&&data.lastMove.ts||data.created;var timeLeft=color==='white'?data.whiteLeftMs:data.blackLeftMs;var finished=data.status==='finished';var isCountdown=color===data.next;return data.type==='online'?getDifferentInTime(timeLeft,lastMove,isCountdown,finished):getDifferentInTime(data.timeLimit*1000,lastMove,isCountdown,finished);};exports.getTimeLimit=getTimeLimit;var getAlarmClockColor=function getAlarmClockColor(game){var timeLimit=getTimeLimit(game.data,game.chessColor)/1000;if(timeLimit<10)return'warning';return'minor';};exports.getAlarmClockColor=getAlarmClockColor;var getFullNotation=function getFullNotation(move){if(!move||!move.san)return null;if(move.san==='O-O'||move.san==='O-O-O')return move;var fullSan="".concat(_constants.NOTATION_FIGURES[move.piece]).concat(move.from,"-").concat(move.san.replace(/^[QRBNK]/,''));return _objectSpread(_objectSpread({},move),{},{san:fullSan});};exports.getFullNotation=getFullNotation;var getItemType=function getItemType(type,data){var current=data.current.length;var comment=data.comment.length;if(type==='moveNum'&&current>=comment)return'current';if(type==='moveNum'&&current<comment)return'comment';return type;};exports.getItemType=getItemType;var getTreeKey=function getTreeKey(item,k){return item[0]&&item[0][0]&&item[0][0].index+item[0][0].san+k;};exports.getTreeKey=getTreeKey;var getNewItems=function getNewItems(element){if(element!==null&&element!==void 0&&element.length&&element[0].color==='b'){return[{moveId:[0,-1],san:'...'}].concat(_toConsumableArray(element));}return element;};exports.getNewItems=getNewItems;var getRelativePosition=function getRelativePosition(elm,container){var cPos=container.getBoundingClientRect();var ePos=elm.getBoundingClientRect();var pos={};pos.top=ePos.top-cPos.top+container.scrollTop;pos.right=ePos.right-cPos.right;pos.bottom=ePos.bottom-cPos.bottom;pos.left=ePos.left-cPos.left;return pos;};exports.getRelativePosition=getRelativePosition;var getIsVisible=function getIsVisible(element,container){var elementTop=element.top;var elementBottom=element.top+44;var containerTop=container.scrollTop;var containerBottom=containerTop+container.clientHeight;return elementTop>=containerTop&&elementBottom<=containerBottom||elementTop<containerTop&&containerTop<elementBottom||elementTop<containerBottom&&containerBottom<elementBottom;};exports.getIsVisible=getIsVisible;var notationScroll=function notationScroll(element,container){var position=getRelativePosition(element,container);var isVisible=getIsVisible(position,container);if(isVisible&&position.top+80>=container.scrollTop+container.clientHeight){container.scroll({top:container.scrollTop+44,behavior:'smooth'});return;}if(isVisible&&position.top-80<container.scrollTop){container.scroll({top:container.scrollTop-44,behavior:'smooth'});return;}if(!isVisible){container.scroll({top:position.top-44,behavior:'smooth'});}};exports.notationScroll=notationScroll;var getColumnLabelColor=function getColumnLabelColor(colors,colorType){return colors.gameNotation[colorType].columnLabel.color;};exports.getColumnLabelColor=getColumnLabelColor;var getCellColor=function getCellColor(colors,colorType,isMoveNum,isActive,isBlocked,isHovered){if(isMoveNum)return colors.gameNotation[colorType].moves.color.moveNum;if(isActive&&!isBlocked)return colors.gameNotation[colorType].moves.color.active;if(isHovered&&!isBlocked)return colors.gameNotation[colorType].moves.color.hovered;if(colors)return colors.gameNotation[colorType].moves.color.normal;return null;};exports.getCellColor=getCellColor;var getCellBackgroundColor=function getCellBackgroundColor(colors,colorType,isLeft,isRight,isNew,isActive,isBlocked,isHovered){if(isLeft||isRight){if(isActive&&!isBlocked)return colors.gameNotation[colorType].moves.backgroundColor.active;if(isHovered&&!isBlocked)return colors.gameNotation[colorType].moves.backgroundColor.hovered;if(isNew)return colors.gameNotation[colorType].moves.backgroundColor["new"];if(isLeft)return colors.gameNotation[colorType].leftColumn.backgroundColor;if(isRight)return colors.gameNotation[colorType].rightColumn.backgroundColor;}return'transparent';};exports.getCellBackgroundColor=getCellBackgroundColor;var getMoveColor=function getMoveColor(isActive,colors,colorType,isBlocked,isHovered){if(isActive&&!isBlocked)return colors.gameNotation[colorType].moves.color.active;if(isHovered&&!isBlocked)return colors.gameNotation[colorType].moves.color.hovered;return colors.gameNotation[colorType].moves.color.normal;};exports.getMoveColor=getMoveColor;var getMoveBackgroundColor=function getMoveBackgroundColor(isActive,colors,colorType,isBlocked,isHovered){if(isActive&&!isBlocked)return colors.gameNotation[colorType].moves.backgroundColor.active;if(isHovered&&!isBlocked)return colors.gameNotation[colorType].moves.backgroundColor.hovered;return colors.gameNotation[colorType].moves.backgroundColor.normal;};exports.getMoveBackgroundColor=getMoveBackgroundColor;var getScrollbarTrackColor=function getScrollbarTrackColor(colors,colorType){return colors.gameNotation[colorType].scrollbar.track.backgroundColor;};exports.getScrollbarTrackColor=getScrollbarTrackColor;var getScrollbarThumbColor=function getScrollbarThumbColor(colors,colorType){return colors.gameNotation[colorType].scrollbar.thumb.backgroundColor;};exports.getScrollbarThumbColor=getScrollbarThumbColor;var getTreeBorderColor=function getTreeBorderColor(colors,colorType){return colors.gameNotation[colorType].tree.borderColor;};exports.getTreeBorderColor=getTreeBorderColor;var getTreeBackgroundColor=function getTreeBackgroundColor(colors,colorType){return colors.gameNotation[colorType].tree.backgroundColor;};exports.getTreeBackgroundColor=getTreeBackgroundColor;var getInlineMoveBackgroundColor=function getInlineMoveBackgroundColor(theme,colorType,isActive){if(isActive)return theme.gameNotation[colorType].inlineMove.backgroundColors.active;return theme.gameNotation[colorType].inlineMove.backgroundColors.normal;};exports.getInlineMoveBackgroundColor=getInlineMoveBackgroundColor;