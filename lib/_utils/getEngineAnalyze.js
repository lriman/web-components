"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=getEngineAnalyze;var _chess=_interopRequireDefault(require("chess.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}function getEngineAnalyze(id,engine,fen,onAnalyze,multiPv,depth){var lines=[];var engineStatus={};for(var i=0;i<multiPv;i+=1){lines.push({});}function uciCmd(cmd){engine.postMessage(cmd);}var prepareAnalyze=function prepareAnalyze(){uciCmd('uci');uciCmd('ucinewgame');uciCmd("setoption name MultiPV value ".concat(multiPv));uciCmd("position fen ".concat(fen));uciCmd("go depth ".concat(depth));};prepareAnalyze();engine.onmessage=function(event){var line;if(event&&_typeof(event)==='object'){line=event.data;}else{line=event;}if(line==='uciok'){engineStatus.engineLoaded=true;}else if(line==='readyok'){engineStatus.engineReady=true;}else if(typeof line==='string'){var part=line.split(' ');var moves=[];var score=0;var multipv=1;var mate;var isPv=false;var chess=new _chess["default"](fen);for(var _i=0;_i<part.length;_i+=1){if(part[_i]==='score'){if(part[_i+1]==='cp')score=parseInt(part[_i+2],10)/100;if(part[_i+1]==='mate')mate=parseInt(part[_i+2],10);}if(part[_i]==='multipv'){multipv=parseInt(part[_i+1],10);}if(isPv&&part[_i]!=='bmc')moves.push(part[_i]);if(part[_i]==='pv')isPv=true;if(part[_i]==='bestmove')isPv=true;if(part[_i]==='bmc')isPv=false;}if(chess.turn()==='b')score*=-1;if(!part.includes('bestmove')){var m=moves.length&&moves[0]||'';var pvn=multipv-1;lines[pvn].move=m;lines[pvn].score=score;lines[pvn].mate=mate;lines[pvn].best=moves;lines[pvn].bestMoveDetails=chess.move(m,{sloppy:true});}if(part.includes('bestmove'))onAnalyze([{id:id,lines:lines}]);}};}