"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ChessboardState=void 0;var _utils=require("./_utils");function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var ChessboardState=/*#__PURE__*/function(){function ChessboardState(id){_classCallCheck(this,ChessboardState);this.squares=new Array(64).fill(null);this.moveInputMode=0;this.orientation=null;this.markers=[];this.arrows=[];this.highLight=[];this.markerColor='#8383EB';this.grid=45;this.sprite=null;this.id=id;this.boardStyles={};}_createClass(ChessboardState,[{key:"setPiece",value:function setPiece(index,piece){this.squares[index]=piece;}},{key:"setId",value:function setId(id){this.id=id;}},{key:"seMarkerColor",value:function seMarkerColor(color){this.markerColor=color;}},{key:"addMarker",value:function addMarker(index,type){var markers=this.markers.filter(function(item){return item.index!==index;});this.markers=[].concat(_toConsumableArray(markers),[{index:index,type:type}]);}},{key:"addArrow",value:function addArrow(data){if(this.arrows.find(function(item){return item.from===data.from&&item.to===data.to;})){var arrows=this.arrows.filter(function(item){return item.from!==data.from||item.to!==data.to;});this.arrows=arrows;}else{this.arrows.push(data);}}},{key:"clearMarkers",value:function clearMarkers(){this.markers=[];this.arrows=[];}},{key:"setSquareTheme",value:function setSquareTheme(theme){this.cssClass=theme;}},{key:"setBoardStyles",value:function setBoardStyles(theme){this.boardStyles=theme;}},{key:"setSprite",value:function setSprite(sprite){this.sprite=sprite;}},{key:"setHighLight",value:function setHighLight(data){this.highLight=Object.keys(data).map(function(item){if(!data[item])return null;var index=(0,_utils.squareToIndex)(item);return[index,data[item]];});}},{key:"setMoveInputMode",value:function setMoveInputMode(value){this.moveInputMode=value;}},{key:"removeMarkers",value:function removeMarkers(){var index=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(index===null&&type===null){this.markers=[];}else{this.markers=this.markers.filter(function(marker){if(marker.type===null){if(index===marker.index){return false;}}else if(index===null){if(marker.type===type){return false;}}else if(marker.type===type&&index===marker.index){return false;}return true;});}}},{key:"setPosition",value:function setPosition(fen){if(fen){var parts=fen.replace(/^\s*/,'').replace(/\s*$/,'').split(/\/|\s/);for(var part=0;part<8;part+=1){var row=parts[7-part].replace(/\d/g,function(str){var numSpaces=parseInt(str,10);var ret='';for(var i=0;i<numSpaces;i+=1){ret+='-';}return ret;});for(var c=0;c<8;c+=1){var _char=row.substr(c,1);var piece=null;if(_char!=='-'){if(_char.toUpperCase()===_char){piece="w".concat(_char.toLowerCase());}else{piece="b".concat(_char);}}this.squares[part*8+c]=piece;}}}}},{key:"getPosition",value:function getPosition(){var parts=new Array(8).fill('');for(var part=0;part<8;part+=1){var spaceCounter=0;for(var i=0;i<8;i+=1){var piece=this.squares[part*8+i];if(piece===null){spaceCounter+=1;}else{if(spaceCounter>0){parts[7-part]+=spaceCounter;spaceCounter=0;}var color=piece.substr(0,1);var name=piece.substr(1,1);if(color==='w'){parts[7-part]+=name.toUpperCase();}else{parts[7-part]+=name;}}}if(spaceCounter>0){parts[7-part]+=spaceCounter;spaceCounter=0;}}return parts.join('/');}}]);return ChessboardState;}();exports.ChessboardState=ChessboardState;