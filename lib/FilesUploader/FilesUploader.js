"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=FilesUploader;var _react=_interopRequireDefault(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _uuid=require("uuid");var _utils=require("../_utils");var _Span=_interopRequireDefault(require("../Typography/Span"));var _FilesUploaderItem=_interopRequireDefault(require("./_internal/FilesUploaderItem"));var _FilesUploaderAdd=_interopRequireDefault(require("./_internal/FilesUploaderAdd"));var _constants=require("./_constants");var _style=require("./_style");var _utils2=require("./_utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}function FilesUploader(props){var id=props.id,_props$files=props.files,files=_props$files===void 0?[]:_props$files,title=props.title,note=props.note,maxFilesQty=props.maxFilesQty,maxFilesTotalSize=props.maxFilesTotalSize,maxFileSize=props.maxFileSize,disabled=props.disabled,accept=props.accept,onChange=props.onChange,onReload=props.onReload;var getMaxFileSize=function getMaxFileSize(){var calcMaxFileSize=maxFilesTotalSize-(0,_utils2.calcFilesTotalSize)(files);return calcMaxFileSize<maxFileSize?calcMaxFileSize:maxFileSize;};var handleAdd=function handleAdd(uploaded){var result=files.concat(uploaded.map(function(file){return{id:(0,_uuid.v4)(),name:file.name,size:file.size,file:file};}));var verified=(0,_utils2.checkConstraints)(result,maxFilesQty,maxFilesTotalSize,maxFileSize);onChange({id:id,files:verified});};var handleItemRemoveClick=function handleItemRemoveClick(itemId){var result=files.filter(function(item){return item.id!==itemId;});var verified=(0,_utils2.checkConstraints)(result,maxFilesQty,maxFilesTotalSize,maxFileSize);onChange({id:id,files:verified});};var handleItemReloadClick=function handleItemReloadClick(fileId){onReload({id:id,fileId:fileId});};return/*#__PURE__*/_react["default"].createElement(_style.StyledFilesUploader,(0,_utils.addDataAttributes)({component:_constants.COMPONENTS.GENERAL}),(title||note)&&/*#__PURE__*/_react["default"].createElement(_style.StyledFilesUploaderHeader,null,title&&/*#__PURE__*/_react["default"].createElement(_Span["default"],{size:_Span["default"].REFS.SIZES.L},title),note&&/*#__PURE__*/_react["default"].createElement(_Span["default"],{size:_Span["default"].REFS.SIZES.S}," ",note)),!disabled&&maxFilesQty>files.length&&/*#__PURE__*/_react["default"].createElement(_FilesUploaderAdd["default"],{id:id,maxSize:getMaxFileSize(),multiple:maxFilesQty!==1,onAdd:handleAdd,accept:accept}),!!files.length&&/*#__PURE__*/_react["default"].createElement(_style.StyledFilesUploaderItems,null,files.map(function(file){return/*#__PURE__*/_react["default"].createElement(_FilesUploaderItem["default"],{key:file.id,id:file.id,name:file.name,loading:file.loading,disabled:disabled,onRemoveClick:handleItemRemoveClick,onReload:handleItemReloadClick});})));}FilesUploader.propTypes={id:_propTypes["default"].string.isRequired,title:_propTypes["default"].string,note:_propTypes["default"].string,accept:_propTypes["default"].string,files:_propTypes["default"].arrayOf(_propTypes["default"].shape({id:_propTypes["default"].string.isRequired,name:_propTypes["default"].string.isRequired,file:_propTypes["default"].shape({}),loading:_propTypes["default"].shape({"final":_propTypes["default"].number,value:_propTypes["default"].number,error:_propTypes["default"].bool})})),maxFilesQty:_propTypes["default"].number,maxFilesTotalSize:_propTypes["default"].number,maxFileSize:_propTypes["default"].number,disabled:_propTypes["default"].bool,onChange:_propTypes["default"].func,onReload:_propTypes["default"].func};FilesUploader.defaultProps={title:undefined,note:undefined,files:undefined,maxFilesQty:Infinity,maxFilesTotalSize:Infinity,maxFileSize:Infinity,disabled:false,onChange:function onChange(){return null;},accept:undefined,onReload:function onReload(){return null;}};