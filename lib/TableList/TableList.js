"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=TableList;var _react=_interopRequireWildcard(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _utils=require("../_utils");var _colorContext=_interopRequireDefault(require("../_context/colorContext"));var _constants=require("./_constants");var _style=require("./_style");var _TableView=require("./_internal/TableView");var _CardsView=require("./_internal/CardsView");var _Pagination=_interopRequireDefault(require("./_internal/Pagination"));var _utils2=require("./_utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj};}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function TableList(props){var viewSwitchingWidth=props.viewSwitchingWidth,captions=props.captions,data=props.data,type=props.type,labels=props.labels,isWithoutRowHover=props.isWithoutRowHover,isWithoutCaptions=props.isWithoutCaptions,renderCaption=props.renderCaption,renderSectionTitle=props.renderSectionTitle,renderRow=props.renderRow,renderCell=props.renderCell,renderCardItem=props.renderCardItem,isDraggable=props.isDraggable,isFitContent=props.isFitContent,isScrollable=props.isScrollable,paginateLimit=props.paginateLimit,handleOnDragEnd=props.handleOnDragEnd,rest=_objectWithoutProperties(props,["viewSwitchingWidth","captions","data","type","labels","isWithoutRowHover","isWithoutCaptions","renderCaption","renderSectionTitle","renderRow","renderCell","renderCardItem","isDraggable","isFitContent","isScrollable","paginateLimit","handleOnDragEnd"]);var node=(0,_react.useRef)(null);var _useState=(0,_react.useState)(0),_useState2=_slicedToArray(_useState,2),nodeWidth=_useState2[0],setNodeWidth=_useState2[1];var _useState3=(0,_react.useState)(data),_useState4=_slicedToArray(_useState3,2),tableData=_useState4[0],setTableData=_useState4[1];var _useState5=(0,_react.useState)((0,_utils2.getInitSortableColumns)(captions)),_useState6=_slicedToArray(_useState5,2),sortableColumns=_useState6[0],setSortableColumns=_useState6[1];var _useState7=(0,_react.useState)(null),_useState8=_slicedToArray(_useState7,2),columnsPagination=_useState8[0],setColumnsPagination=_useState8[1];var _useState9=(0,_react.useState)((0,_utils2.getInitPagination)(paginateLimit,data)),_useState10=_slicedToArray(_useState9,2),pagination=_useState10[0],setPagination=_useState10[1];var handleResize=function handleResize(){var _node$current$getBoun=node.current.getBoundingClientRect(),width=_node$current$getBoun.width;if(nodeWidth!==width)setNodeWidth(node.current.getBoundingClientRect().width);};var handleSort=function handleSort(item){if(!item.sort)return;var sortableColumnsData=(0,_utils2.getSortableColumns)(sortableColumns,item);setSortableColumns(sortableColumnsData);setTableData((0,_utils2.getSortedData)(data,item,sortableColumnsData));};var handleGo=function handleGo(value){if(value==='left')setColumnsPagination(_objectSpread(_objectSpread({},columnsPagination),{},{offset:columnsPagination.offset-1}));if(value==='right')setColumnsPagination(_objectSpread(_objectSpread({},columnsPagination),{},{offset:columnsPagination.offset+1}));};(0,_react.useEffect)(function(){var item=(0,_utils2.getUpdateSortItem)(sortableColumns,captions);if(item)setTableData((0,_utils2.getSortedData)(data,item,sortableColumns));else setTableData(data);if(pagination)setPagination(_objectSpread(_objectSpread({},pagination),{},{total:(0,_utils2.getPaginateTotal)(data)}));},[data,captions,sortableColumns]);//eslint-disable-line
(0,_react.useEffect)(function(){setColumnsPagination((0,_utils2.getColumnsPagination)(nodeWidth,captions));},[nodeWidth,captions]);(0,_react.useEffect)(function(){handleResize();window.addEventListener('resize',handleResize);return function(){window.removeEventListener('resize',handleResize);};});var _useContext=(0,_react.useContext)(_colorContext["default"]),_useContext$colorType=_useContext.colorType,colorType=_useContext$colorType===void 0?'normal':_useContext$colorType;var calcCaptions=(0,_react.useMemo)(function(){return(0,_utils2.getCalcCaptions)(captions,columnsPagination);},[captions,columnsPagination]);var paginatedTableData=(0,_react.useMemo)(function(){return(0,_utils2.getPaginatedTableData)(tableData,pagination);},[tableData,pagination]);return/*#__PURE__*/_react["default"].createElement(_style.StyledTableList,_extends({},(0,_utils.addDataAttributes)({component:_constants.COMPONENTS.GENERAL}),{ref:node}),!!nodeWidth&&nodeWidth<viewSwitchingWidth&&/*#__PURE__*/_react["default"].createElement(_style.StyledTableListCardView,null,/*#__PURE__*/_react["default"].createElement(_CardsView.TableListCardsViewData,_extends({data:data,captions:captions,renderSectionTitle:renderSectionTitle,renderRow:renderRow,renderCell:renderCell,colorType:colorType,renderCardItem:renderCardItem},rest))),!!nodeWidth&&nodeWidth>=viewSwitchingWidth&&/*#__PURE__*/_react["default"].createElement(_style.StyledTableListTableView,{isFitContent:isFitContent,isScrollable:isScrollable},!isWithoutCaptions&&/*#__PURE__*/_react["default"].createElement(_TableView.TableListTableViewCaptions,{items:calcCaptions,colorType:colorType,type:type,renderCaption:renderCaption,sortableColumns:sortableColumns,isScrollable:isScrollable,handleSort:handleSort,handleGo:handleGo}),/*#__PURE__*/_react["default"].createElement(_TableView.TableListTableViewData,_extends({data:paginatedTableData,type:type,captions:calcCaptions,renderSectionTitle:renderSectionTitle,renderRow:renderRow,renderCell:renderCell,colorType:colorType,isWithoutRowHover:isWithoutRowHover,isDraggable:isDraggable,isScrollable:isScrollable,handleOnDragEnd:handleOnDragEnd},rest)),/*#__PURE__*/_react["default"].createElement(_Pagination["default"],{labels:labels,pagination:pagination,setPagination:setPagination})));}TableList.propTypes={viewSwitchingWidth:_propTypes["default"].number.isRequired,captions:_propTypes["default"].arrayOf(_propTypes["default"].shape({id:_propTypes["default"].string.isRequired,align:_propTypes["default"].oneOf(['left','center','right']),title:_propTypes["default"].string.isRequired,tableViewWidth:_propTypes["default"].number.isRequired,tableViewMinWidth:_propTypes["default"].number,cardsViewWidth:_propTypes["default"].number,isPaginate:_propTypes["default"].bool,sortOrder:_propTypes["default"].oneOf(Object.values(_constants.REFS.SORT_ORDERS)),sort:_propTypes["default"].func})).isRequired,data:_propTypes["default"].arrayOf(_propTypes["default"].shape({id:_propTypes["default"].string.isRequired,title:_propTypes["default"].string,items:_propTypes["default"].arrayOf(_propTypes["default"].shape({id:_propTypes["default"].string.isRequired})).isRequired})).isRequired,type:_propTypes["default"].oneOf(Object.values(_constants.REFS.TYPES)),labels:_propTypes["default"].shape(),isWithoutRowHover:_propTypes["default"].bool,isWithoutCaptions:_propTypes["default"].bool,renderCaption:_propTypes["default"].func,renderSectionTitle:_propTypes["default"].func,renderRow:_propTypes["default"].func,renderCell:_propTypes["default"].func,renderCardItem:_propTypes["default"].func,isDraggable:_propTypes["default"].bool,isFitContent:_propTypes["default"].bool,isScrollable:_propTypes["default"].bool,paginateLimit:_propTypes["default"].number,handleOnDragEnd:_propTypes["default"].func};TableList.defaultProps={type:_constants.REFS.TYPES.PRIMARY,labels:undefined,isWithoutRowHover:false,isWithoutCaptions:false,renderCaption:undefined,renderSectionTitle:undefined,renderRow:undefined,renderCell:undefined,renderCardItem:undefined,isDraggable:false,isFitContent:false,isScrollable:false,paginateLimit:undefined,handleOnDragEnd:function handleOnDragEnd(){}};